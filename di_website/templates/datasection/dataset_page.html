{% extends "layouts/default.html" %}
{% load static wagtailcore_tags wagtailimages_tags card_tags generic_tags navigation_tags string_utils %}

{% block hero %}
  {% include 'includes/heroes/hero-dataset.html' %}
{% endblock hero %}

{% block body %}

  <section class="section" id="modal-container">
    <div class="row row--narrow">
      <div class="l-sidebar">
        <aside class="l-sidebar__aside">
          <div class="aside aside--clipping">
            {% secondary_menu parent=self.get_parent.get_parent calling_page=self %}
          </div>
        </aside>
        <div class="l-sidebar__body">
          {% if page.release_date %}
            <div class="m-notice">
                Release date : {{ page.release_date | date:'d F, o'  }}
            </div>
          {% endif %}
          <div class="is-typeset wysiwyg">
            {% for block in page.body %}
              {% include_block block %}
            {% endfor %}
          </div>
          {% comment %} TODO: Add Alert {% endcomment %}

          <div class="l-2up space-section-top">
            {% if page.dataset_downloads.count %}
              <div class="l-2up__col">
                <div class="button button--faux button--icon">
                  <i role="presentation" aria-hidden="true" class="ico ico--24 ico-download-poppy"></i>
                  <span class="button--faux__meta">Download</span>
                  <ul class="button--faux__list">
                    {% for item in page.get_dataset_downloads %}
                      {% if item.file|file_info != item.file.title %}
                        <li>
                          <a href="{{ item.file.url }}" class="js-ga-download-click"
                            data-event-label="Download {{ item.file }}"
                            title="Download {{ item.file | file_label }}">{{item.file}} - {{ item.file|file_info }}</a>
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                  <p class="button--faux__note">XLS files contain the dataset, metadata and charts / images</p>
                  <p class="button--faux__note">CSV files contain the raw dataset</p>
                </div>
              </div>
            {% endif %}
            <div class="l-2up__col">
              {% for author in page.authors %}
                {% if author.block_type == 'internal_author' %}
                  {% with page=author.value img=author.value.image name=author.value.name position=author.value.position %}
                    {% with class_name='m-author--spacing' author_prefix='Analysis by' %}
                      {% include 'includes/partials/author-link.html' %}
                    {% endwith %}
                  {% endwith %}
                {% else %}
                  {% with page=None img=author.value.photograph name=author.value.name position=author.value.title %}
                    {% with link=author.value.page class_name='m-author--spacing' author_prefix='Analysis by' %}
                      {% include 'includes/partials/author-link.html' %}
                    {% endwith %}
                  {% endwith %}
                {% endif %}
              {% endfor %}
              <p class="para">
                Contact <a href="#">data@devinit.org</a> if you have any queries about this dataset or other data related matters.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>


  {% if page.meta_data %}
    <section class="section">
      <div class="row row--narrow">
        <h2 class="section__heading">Metadata</h2>
        <div id="responsive-tabs" class="responsive-tabs">
          <ul class="tab__menu">
            <li class="tab__link"><a href="#description">Description</a></li>
            <li class="tab__link"><a href="#sources">Sources</a></li>
            <li class="tab__link"><a href="#legal">Legal & Suggested Citation</a></li>
          </ul>
          <div class="tab__container">
            <section id="description" class="tab__content">
              <div class="is-typeset max-meter">
                {% for block in page.meta_data %}
                  {% if block.block_type == 'description' %}
                    {% include_block block %}
                  {% endif %}
                {% endfor %}
              </div>
              <div class="l-2up">
                {% for block in page.meta_data %}
                  {% if block.block_type == 'provenance' or block.block_type == 'geography' or block.block_type == 'variables' %}
                    <div class="l-2up__col">
                      <div class="is-typeset">
                        {% if block.block_type == 'provenance' %}
                          <h3>Provenance</h3>
                          {% include_block block %}
                        {% endif %}

                        {% if block.block_type == 'geography' %}
                          <h3>Geography</h3>
                          {% include_block block %}
                        {% endif %}

                        {% if block.block_type == 'variables' %}
                          <h3>Variables</h3>
                          {% include_block block %}
                        {% endif %}
                      </div>
                    </div>
                  {% endif %}
                {% endfor %}

                {% if topics|length %}
                  <div class="l-2up__col">
                    <div class="is-typeset">
                      <h3>Topics</h3>
                      <ul>
                        {% for topic in topics %}
                          <li>{{topic}}</li>
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                {% endif %}
              </div>
            </section>
            <section id="sources" class="tab__content">
              <div class="l-3up">
                {% for source in page.get_dataset_sources %}
                  <div class="m-slip m-slip--alt m-slip--icon">
                    <i role="presentation" aria-hidden="true" class="ico ico--24 ico-data-slate"></i>
                    <p class="m-slip__copy">
                      <a href="{{source.source.link_to_metadata}}">{{source.source.title}}</a>
                    </p>
                    {% if source.source.date_of_access %}
                      <span class="m-slip__meta">Accessed: {{source.source.date_of_access}}</span>
                    {% endif %}
                    {% if source.source.link_to_data %}
                      <a href="{{source.source.link_to_data}}" class="button button--reverses">
                        View source dataset
                      </a>
                    {% endif %}
                  </div>
                {% endfor %}


              </div>
              <div class="is-typeset max-meter">
                <p>Access Dates: explanation as to what the access date is and why it is relevant.</p>
              </div>
            </section>
            <section id="legal" class="tab__content">
              <div class="is-typeset max-meter">
                {% for block in page.meta_data %}
                  {% if block.block_type == 'licence' %}
                    <h3>Licence</h3>
                    {% include_block block %}
                  {% endif %}

                  {% if block.block_type == 'citation' %}
                    <h3>Suggested Citation</h3>
                    <div class="selectable">
                      {% include_block block %}
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
            </section>
          </div>
        </div>

      </div>
    </section>
  {% endif %}


  {% if related_datasets|length %}
    <section class="section">
      <div class="row row--narrow">
        <h2 class="section__heading">{{ page.related_datasets_title }}</h2>
        <div class="l-3up">
          {% for item in related_datasets %}
            <div class="m-slip m-slip--icon">
              <i role="presentation" aria-hidden="true" class="ico ico--24 ico-data-poppydark"></i>
              <p class="m-slip__copy">
                <a href="{% pageurl item %}">{{item.specific.title}}</a>
              </p>
              <span class="m-slip__meta">Released: {{item.specific.release_date}}</span>
            </div>
          {% endfor %}
        </div>
      </div>
    </section>
  {% endif %}


  <section class="section">
    {% get_other_pages calling_page=self heading=page.other_pages_heading %}
  </section>

{% endblock %}
